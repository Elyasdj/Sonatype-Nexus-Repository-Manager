what is sontype nexus?

use case?

##Install Java


sudo hostnamectl set-hostname Nexus_server

sudo yum install java

java -version




##Install Nexus


useradd -M -d /opt/nexus -s /bin/bash -r nexus

echo "nexus ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/nexus

mkdir /opt/nexus

wget https://download.sonatype.com/nexus/3/nexus-3.85.0-03-linux-x86_64.tar.gz

tar -xzf nexus-3.85.0-03-linux-x86_64.tar.gz -C /opt/nexus --strip-components=1

chown -R nexus:nexus /opt/nexus

vim /opt/nexus/bin/nexus.vmoptions

vim /opt/nexus/bin/nexus.rc

-u nexus sh -c "cd /opt/nexus && ./bin/nexus start"

tail -f /opt/nexus/sonatype-work/nexus3/log/nexus.log

ss -tunpla | grep 8081

firewall-cmd --add-port=8081/tcp --permanent

firewall-cmd --reload

# check http://your-ip:8081 

/opt/nexus/bin/nexus stop



##Create a Systemd Service File for Nexus


vim /usr/lib/systemd/system/nexus.service

systemctl daemon-reload

systemctl enable --now nexus

systemctl status --now nexus



##Configure Nginx as a Reverse Proxy for Nexus


dnf install nginx -y

vim /etc/nginx/conf.d/nexus.conf

nginx -t

systemctl restart nginx

systemctl enable --now nginx

systemctl status nginx.service

cat /opt/nexus/sonatype-work/nexus3/admin.password



##Security & Hardening


mkdir -p /etc/nginx/ssl

cd /etc/nginx/ssl

openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/nginx/ssl/nexus.edj.com.key \
  -out /etc/nginx/ssl/nexus.edj.com.crt

chmod 600 /etc/nginx/ssl/nexus.*

chown root:root /etc/nginx/ssl/nexus.*



##Tshoot


tail -f /var/log/nginx/error.log

**RH : if SElinux is enable, turn it off

sestatus

setenforce 0

**after finishing nginx setup 

setenforce 1

**DEB : if AppArmor is enable, turn it off 

vim /etc/apparmor.d/usr.sbin.nginx

add this line=> network inet stream,
add this line=> network inet6 stream,

sudo apparmor_parser -r /etc/apparmor.d/usr.sbin.nginx



##Set hosts on offline machine


sudo vim /etc/hosts

192.168.560.155 nexus.edj.com

**RH : curl -Ik https://nexus.edj.com

*DEB : curl -I https://nexus.edj.com



##Create Local Repo

**DEB : Go to your https://nexus.edj.com and follow this path
settings > repositories > create repository > choose apt(proxy)

*tip : what is the different of apt(hosted) and apt(hosted)?

cat /etc/os-release

sudo mv /etc/apt/sources.list.d/ubuntu.sources /etc/apt/sources.list.d/ubuntu.sources.bak

sudo vim /etc/apt/sources.list.d/ubuntu.sources

**RH : Go to your https://nexus.edj.com and follow this path
settings > repositories > create repository > choose yum(proxy)

cat /etc/os-release

sudo vim /etc/yum.repos.d/local.repo


##Nexus Monitoring


**we dont need nexus-exporter 
**sonatype-nexus have already integrated with prometheus Docs: https://help.sonatype.com/en/prometheus.html
**Grafana Dashboard for Nexus: Infra / Nexus (Nexus Dashboard by KL) -> 16459



##Tuning Linux Kernel  for Nexus

###Tuning Nexus

1.  Chanage Machine-ID 

Show Machine ID: 

cat /etc/machine-id 
or 
hostnamectl | grep "Machine ID"

Change Machine ID:

sudo rm -rfv /etc/machine-id
sudo systemd-machine-id-setup

2.  Memory setting of Nexus 

*tip: Nexus is a resource-hungry monster, especially RAM and disk I/O. 90% of performance issues come from this.

First : Memory setting (JVM)

vim /opt/nexus/bin/nexus.vmoptions

Limit Memory : 4 GB
Limit Core : 4 Core

*tip: Never give more than 50% to 60% of the total server RAM to Nexus.


Second : Disk isolation (I/O)

Best Practice :

Disk1 (SSD/NVME): rocky + nexus + nexus
Disk2 (Faster SSD/NVME): "sonatype-work" Directory
Disk3 (Huge SSD/SAN): "Blob Stores" Directory

###Tuning OS


3.  Increasing file limits (File Handles)

vim /etc/security/limits.conf

add these line=> 

root    soft   nofile   65536
root    hard   nofile   65536
nexus   soft   nofile   65536
nexus   hard   nofile   65536
nginx   soft   nofile   65536
nginx   hard   nofile   65536

*tip: Make sure that nexus execute with nexus user (nginx too)

4.  Network Tuning

vim /etc/sysctl.d/99-prod.conf

add these line=> 

# Increase the maximum number of open files in the entire system
fs.file-max = 2097152

# Increase incoming connection queue (for Nginx)
net.core.somaxconn = 65536

# Fast reuse of sockets in TIME-WAIT mode
net.ipv4.tcp_tw_reuse = 1

# Increase the local port range
net.ipv4.ip_local_port_range = 1024 65000

sysctl -p

5.  Manage SELinux (Default Mode: Enforcing)

Turn it off temporary 

setenforce 0

After your done make bakc on

setenforce 1

6.  Firewall (firewalld | ufw)

Make sure that your necessary port is open 
